dnl Process this file with autoconf to produce a configure script.
AC_INIT(include/SOAP.h)
AM_INIT_AUTOMAKE(EasySoap++, 0.2)

dnl Checks for programs.
AC_CHECK_TOOL(RANLIB, ranlib, :)
AM_PROG_LIBTOOL
AC_PROG_CC
AC_PROG_CXX
AC_PROG_CPP
AC_PROG_MAKE_SET
AC_PATH_PROG(MAKEDEPEND, makedepend, $TRUE)

dnl Checks for libraries.
AC_CHECK_LIB(expat, XML_Parse)
AC_CHECK_LIB(ssl, SSL_connect)

dnl Checks for header files.
AC_HEADER_STDC

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_TYPE_SIZE_T

dnl Checks for library functions.

dnl Standard macros.
STATIC_EASYSOAP_LIBS="\$(top_builddir)/src/libeasysoap.a"
DYNAMIC_EASYSOAP_LIBS="-L \$(top_builddir)/src -leasysoap"
EASYSOAP_INCLUDES="-I \$(top_srcdir)/include"
AC_SUBST(STATIC_EASYSOAP_LIBS)
AC_SUBST(DYNAMIC_EASYSOAP_LIBS)
AC_SUBST(EASYSOAP_INCLUDES)

# REV: Need to autodetect & create macros for the location of Expat
# stuff.
EXPAT_LIBS="-lexpat"
EXPAT_INCLUDES=""
AC_SUBST(EXPAT_LIBS)
AC_SUBST(EXPAT_INCLUDES)

dnl Platform Specifics
case "$host_os" in
  linux*)
    SSL_LIBS="-lcrypto -lssl"
	NETWORK_LIBS=""
	;;

  solaris2*)
    SSL_LIBS=""
	NETWORK_LIBS="-lsocket -lnsl"
	;;

  # REV: ??
  cygwin*)
    SSL_LIBS="-lssl -lcrypto"
	NETWORK_LIBS="-lwsock32"
	;;
esac

dnl Optional crud
AC_ARG_WITH(ssl,
[  --with-ssl[=ARG]        Compile SSL Support [ARG=yes]],
[case "${withval}" in
   yes)
     SSL_DEFINES="-DEASYSOAP_SSL"
	 ;;
   no)
     SSL_DEFINES=""
	 SSL_LIBS=""
	 ;;
   *)
     echo "${withval} is not a valid option for --with-ssl."
	 exit 1;
	 ;;
esac],
[SSL_DEFINES="-DEASYSOAP_SSL"])
    
AC_SUBST(SSL_DEFINES)
AC_SUBST(SSL_LIBS)
AC_SUBST(NETWORK_LIBS)

AC_OUTPUT(Makefile simpleserver/Makefile validator/Makefile tests/Makefile src/Makefile include/Makefile)
